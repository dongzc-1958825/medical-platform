# 修复bug的404.html
@'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>众创医案平台</title>
    <script>
        // 修复版SPA重定向
        (function() {
            console.log('[404.html] 启动重定向逻辑');
            
            const path = window.location.pathname;
            console.log('当前路径:', path);
            
            const basePath = '/medical-platform';
            
            // 如果是404页面本身
            if (path.includes('404.html')) {
                window.location.replace(basePath + '/');
                return;
            }
            
            // 提取请求路径
            let requestedPath = path;
            if (requestedPath.startsWith(basePath)) {
                requestedPath = requestedPath.slice(basePath.length);
            }
            
            console.log('处理后路径:', requestedPath);
            
            // 修复bug：正确构建hash
            let targetHash = '';
            if (requestedPath === '/' || requestedPath === '' || requestedPath === '/index.html') {
                targetHash = '#/';
            } else {
                // 修复这里：去掉开头的斜杠，然后加上#和斜杠
                targetHash = '#/' + requestedPath.replace(/^\//, '');
            }
            
            const newUrl = window.location.origin + basePath + targetHash;
            console.log('重定向到:', newUrl);
            
            window.location.replace(newUrl);
            
        })();
    </script>
</head>
<body>
    <noscript>
        <div style="text-align: center; padding: 50px;">
            <h2>请启用JavaScript</h2>
            <a href="/medical-platform/">点击这里返回首页</a>
        </div>
    </noscript>
    <div style="text-align: center; padding: 50px;">
        <h2>正在重定向...</h2>
    </div>
</body>
</html>
'@ | Out-File -FilePath docs/404.html -Encoding UTF8 -Force